import{C as st,Ma as L,Na as ot,Oa as ie,Qa as $,Ra as T,Sa as y,T as K,Ua as B,c as P,d as O,e as et,f as xe,g as tt,h as ue,i as R,k as b,l as g,m as nt,n as F,o as re,s as rt,v as it,va as fe,z as p}from"./chunk-QCAVYV6E.js";import{a as ce,b as Ze,c as Qe}from"./chunk-CWTPBX7D.js";var Cn=/^\s*>\s$/,lt=y.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:e}){return["blockquote",p(this.options.HTMLAttributes,e),0]},addCommands(){return{setBlockquote:()=>({commands:e})=>e.wrapIn(this.name),toggleBlockquote:()=>({commands:e})=>e.toggleWrap(this.name),unsetBlockquote:()=>({commands:e})=>e.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[$({find:Cn,type:this.type})]}});var kn=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))$/,Sn=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))/g,xn=/(?:^|\s)((?:__)((?:[^__]+))(?:__))$/,Dn=/(?:^|\s)((?:__)((?:[^__]+))(?:__))/g,at=T.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:e=>e.style.fontWeight!=="normal"&&null},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}]},renderHTML({HTMLAttributes:e}){return["strong",p(this.options.HTMLAttributes,e),0]},addCommands(){return{setBold:()=>({commands:e})=>e.setMark(this.name),toggleBold:()=>({commands:e})=>e.toggleMark(this.name),unsetBold:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[L({find:kn,type:this.type}),L({find:xn,type:this.type})]},addPasteRules(){return[B({find:Sn,type:this.type}),B({find:Dn,type:this.type})]}});var On=y.create({name:"listItem",addOptions(){return{HTMLAttributes:{}}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:e}){return["li",p(this.options.HTMLAttributes,e),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),dt=T.create({name:"textStyle",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"span",getAttrs:e=>e.hasAttribute("style")?{}:!1}]},renderHTML({HTMLAttributes:e}){return["span",p(this.options.HTMLAttributes,e),0]},addCommands(){return{removeEmptyTextStyle:()=>({state:e,commands:t})=>{let n=fe(e,this.type);return Object.entries(n).some(([,i])=>!!i)?!0:t.unsetMark(this.name)}}}}),ct=/^\s*([-+*])\s$/,ut=y.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:e}){return["ul",p(this.options.HTMLAttributes,e),0]},addCommands(){return{toggleBulletList:()=>({commands:e,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(On.name,this.editor.getAttributes(dt.name)).run():e.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let e=$({find:ct,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(e=$({find:ct,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(dt.name),editor:this.editor})),[e]}});var Tn=/(?:^|\s)((?:`)((?:[^`]+))(?:`))$/,Nn=/(?:^|\s)((?:`)((?:[^`]+))(?:`))/g,ft=T.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:e}){return["code",p(this.options.HTMLAttributes,e),0]},addCommands(){return{setCode:()=>({commands:e})=>e.setMark(this.name),toggleCode:()=>({commands:e})=>e.toggleMark(this.name),unsetCode:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[L({find:Tn,type:this.type})]},addPasteRules(){return[B({find:Nn,type:this.type})]}});var An=/^```([a-z]+)?[\s\n]$/,Pn=/^~~~([a-z]+)?[\s\n]$/,ht=y.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:null,parseHTML:e=>{var t;let{languageClassPrefix:n}=this.options,s=[...((t=e.firstElementChild)===null||t===void 0?void 0:t.classList)||[]].filter(o=>o.startsWith(n)).map(o=>o.replace(n,""))[0];return s||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:e,HTMLAttributes:t}){return["pre",p(this.options.HTMLAttributes,t),["code",{class:e.attrs.language?this.options.languageClassPrefix+e.attrs.language:null},0]]},addCommands(){return{setCodeBlock:e=>({commands:t})=>t.setNode(this.name,e),toggleCodeBlock:e=>({commands:t})=>t.toggleNode(this.name,"paragraph",e)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{let{empty:e,$anchor:t}=this.editor.state.selection,n=t.pos===1;return!e||t.parent.type.name!==this.name?!1:n||!t.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:e})=>{if(!this.options.exitOnTripleEnter)return!1;let{state:t}=e,{selection:n}=t,{$from:r,empty:i}=n;if(!i||r.parent.type!==this.type)return!1;let s=r.parentOffset===r.parent.nodeSize-2,o=r.parent.textContent.endsWith(`

`);return!s||!o?!1:e.chain().command(({tr:l})=>(l.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:e})=>{if(!this.options.exitOnArrowDown)return!1;let{state:t}=e,{selection:n,doc:r}=t,{$from:i,empty:s}=n;if(!s||i.parent.type!==this.type||!(i.parentOffset===i.parent.nodeSize-2))return!1;let l=i.after();return l===void 0||r.nodeAt(l)?!1:e.commands.exitCode()}}},addInputRules(){return[ie({find:An,type:this.type,getAttributes:e=>({language:e[1]})}),ie({find:Pn,type:this.type,getAttributes:e=>({language:e[1]})})]},addProseMirrorPlugins(){return[new F({key:new re("codeBlockVSCodeHandler"),props:{handlePaste:(e,t)=>{if(!t.clipboardData||this.editor.isActive(this.type.name))return!1;let n=t.clipboardData.getData("text/plain"),r=t.clipboardData.getData("vscode-editor-data"),i=r?JSON.parse(r):void 0,s=i?.mode;if(!n||!s)return!1;let{tr:o}=e.state;return o.replaceSelectionWith(this.type.create({language:s})),o.setSelection(b.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.insertText(n.replace(/\r\n?/g,`
`)),o.setMeta("paste",!0),e.dispatch(o),!0}}})]}});var pt=y.create({name:"doc",topNode:!0,content:"block+"});function mt(e={}){return new F({view(t){return new De(t,e)}})}var De=class{constructor(t,n){var r;this.editorView=t,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(r=n.width)!==null&&r!==void 0?r:1,this.color=n.color===!1?void 0:n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(i=>{let s=o=>{this[i](o)};return t.dom.addEventListener(i,s),{name:i,handler:s}})}destroy(){this.handlers.forEach(({name:t,handler:n})=>this.editorView.dom.removeEventListener(t,n))}update(t,n){this.cursorPos!=null&&n.doc!=t.state.doc&&(this.cursorPos>t.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(t){t!=this.cursorPos&&(this.cursorPos=t,t==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let t=this.editorView.state.doc.resolve(this.cursorPos),n=!t.parent.inlineContent,r;if(n){let l=t.nodeBefore,a=t.nodeAfter;if(l||a){let d=this.editorView.nodeDOM(this.cursorPos-(l?l.nodeSize:0));if(d){let c=d.getBoundingClientRect(),u=l?c.bottom:c.top;l&&a&&(u=(u+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),r={left:c.left,right:c.right,top:u-this.width/2,bottom:u+this.width/2}}}}if(!r){let l=this.editorView.coordsAtPos(this.cursorPos);r={left:l.left-this.width/2,right:l.left+this.width/2,top:l.top,bottom:l.bottom}}let i=this.editorView.dom.offsetParent;this.element||(this.element=i.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n);let s,o;if(!i||i==document.body&&getComputedStyle(i).position=="static")s=-pageXOffset,o=-pageYOffset;else{let l=i.getBoundingClientRect();s=l.left-i.scrollLeft,o=l.top-i.scrollTop}this.element.style.left=r.left-s+"px",this.element.style.top=r.top-o+"px",this.element.style.width=r.right-r.left+"px",this.element.style.height=r.bottom-r.top+"px"}scheduleRemoval(t){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),t)}dragover(t){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:t.clientX,top:t.clientY}),r=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),i=r&&r.type.spec.disableDropCursor,s=typeof i=="function"?i(this.editorView,n,t):i;if(n&&!s){let o=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let l=ue(this.editorView.state.doc,o,this.editorView.dragging.slice);l!=null&&(o=l)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(t){(t.target==this.editorView.dom||!this.editorView.dom.contains(t.relatedTarget))&&this.setCursor(null)}};var gt=K.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[mt(this.options)]}});var Y=function(e){for(var t=0;;t++)if(e=e.previousSibling,!e)return t};var It=function(e,t,n,r){return n&&(yt(e,t,n,r,-1)||yt(e,t,n,r,1))},En=/^(img|br|input|textarea|hr)$/i;function yt(e,t,n,r,i){for(;;){if(e==n&&t==r)return!0;if(t==(i<0?0:he(e))){let s=e.parentNode;if(!s||s.nodeType!=1||ze(e)||En.test(e.nodeName)||e.contentEditable=="false")return!1;t=Y(e)+(i<0?0:1),e=s}else if(e.nodeType==1){if(e=e.childNodes[t+(i<0?-1:0)],e.contentEditable=="false")return!1;t=i<0?he(e):0}else return!1}}function he(e){return e.nodeType==3?e.nodeValue.length:e.childNodes.length}function In(e,t,n){for(let r=t==0,i=t==he(e);r||i;){if(e==n)return!0;let s=Y(e);if(e=e.parentNode,!e)return!1;r=r&&s==0,i=i&&s==he(e)}}function ze(e){let t;for(let n=e;n&&!(t=n.pmViewDesc);n=n.parentNode);return t&&t.node&&t.node.isBlock&&(t.dom==e||t.contentDOM==e)}var Rt=function(e){return e.focusNode&&It(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)};function Lt(e,t){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=e,n.key=n.code=t,n}var V=typeof navigator<"u"?navigator:null,bt=typeof document<"u"?document:null,W=V&&V.userAgent||"",Te=/Edge\/(\d+)/.exec(W),Bt=/MSIE \d/.exec(W),Ne=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(W),ne=!!(Bt||Ne||Te),Fe=Bt?document.documentMode:Ne?+Ne[1]:Te?+Te[1]:0,be=!ne&&/gecko\/(\d+)/i.test(W);be&&+(/Firefox\/(\d+)/.exec(W)||[0,0])[1];var Ae=!ne&&/Chrome\/(\d+)/.exec(W),X=!!Ae,Rn=Ae?+Ae[1]:0,J=!ne&&!!V&&/Apple Computer/.test(V.vendor),Ke=J&&(/Mobile\/\w+/.test(W)||!!V&&V.maxTouchPoints>2),N=Ke||(V?/Mac/.test(V.platform):!1),Ln=V?/Win/.test(V.platform):!1,ae=/Android \d/.test(W),$e=!!bt&&"webkitFontSmoothing"in bt.documentElement.style,Bn=$e?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;var Vt=function(e){e&&(this.nodeName=e)};Vt.prototype=Object.create(null);var ii=[new Vt];function Vn(e,t=null){let n=e.domSelectionRange(),r=e.state.doc;if(!n.focusNode)return null;let i=e.docView.nearestDesc(n.focusNode),s=i&&i.size==0,o=e.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(o<0)return null;let l=r.resolve(o),a,d;if(Rt(n)){for(a=l;i&&!i.node;)i=i.parent;let c=i.node;if(i&&c.isAtom&&g.isSelectable(c)&&i.parent&&!(c.isInline&&In(n.focusNode,n.focusOffset,i.dom))){let u=i.posBefore;d=new g(o==u?l:r.resolve(u))}}else{let c=e.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(c<0)return null;a=r.resolve(c)}if(!d){let c=t=="pointer"||e.state.selection.head<l.pos&&!s?1:-1;d=zt(e,a,l,c)}return d}function Ht(e){return e.editable?e.hasFocus():Kn(e)&&document.activeElement&&document.activeElement.contains(e.dom)}function ve(e,t=!1){let n=e.state.selection;if(Fn(e,n),!!Ht(e)){if(!t&&e.input.mouseDown&&e.input.mouseDown.allowDefault&&X){let r=e.domSelectionRange(),i=e.domObserver.currentSelection;if(r.anchorNode&&i.anchorNode&&It(r.anchorNode,r.anchorOffset,i.anchorNode,i.anchorOffset)){e.input.mouseDown.delayedSelectionSync=!0,e.domObserver.setCurSelection();return}}if(e.domObserver.disconnectSelection(),e.cursorWrapper)zn(e);else{let{anchor:r,head:i}=n,s,o;Mt&&!(n instanceof b)&&(n.$from.parent.inlineContent||(s=Ct(e,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(o=Ct(e,n.to))),e.docView.setSelection(r,i,e.root,t),Mt&&(s&&kt(s),o&&kt(o)),n.visible?e.dom.classList.remove("ProseMirror-hideselection"):(e.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&Hn(e))}e.domObserver.setCurSelection(),e.domObserver.connectSelection()}}var Mt=J||X&&Rn<63;function Ct(e,t){let{node:n,offset:r}=e.docView.domFromPos(t,0),i=r<n.childNodes.length?n.childNodes[r]:null,s=r?n.childNodes[r-1]:null;if(J&&i&&i.contentEditable=="false")return Oe(i);if((!i||i.contentEditable=="false")&&(!s||s.contentEditable=="false")){if(i)return Oe(i);if(s)return Oe(s)}}function Oe(e){return e.contentEditable="true",J&&e.draggable&&(e.draggable=!1,e.wasDraggable=!0),e}function kt(e){e.contentEditable="false",e.wasDraggable&&(e.draggable=!0,e.wasDraggable=null)}function Hn(e){let t=e.dom.ownerDocument;t.removeEventListener("selectionchange",e.input.hideSelectionGuard);let n=e.domSelectionRange(),r=n.anchorNode,i=n.anchorOffset;t.addEventListener("selectionchange",e.input.hideSelectionGuard=()=>{(n.anchorNode!=r||n.anchorOffset!=i)&&(t.removeEventListener("selectionchange",e.input.hideSelectionGuard),setTimeout(()=>{(!Ht(e)||e.state.selection.visible)&&e.dom.classList.remove("ProseMirror-hideselection")},20))})}function zn(e){let t=e.domSelection(),n=document.createRange(),r=e.cursorWrapper.dom,i=r.nodeName=="IMG";i?n.setEnd(r.parentNode,Y(r)+1):n.setEnd(r,0),n.collapse(!1),t.removeAllRanges(),t.addRange(n),!i&&!e.state.selection.visible&&ne&&Fe<=11&&(r.disabled=!0,r.disabled=!1)}function Fn(e,t){if(t instanceof g){let n=e.docView.descAt(t.from);n!=e.lastSelectedViewDesc&&(St(e),n&&n.selectNode(),e.lastSelectedViewDesc=n)}else St(e)}function St(e){e.lastSelectedViewDesc&&(e.lastSelectedViewDesc.parent&&e.lastSelectedViewDesc.deselectNode(),e.lastSelectedViewDesc=void 0)}function zt(e,t,n,r){return e.someProp("createSelectionBetween",i=>i(e,t,n))||b.between(t,n,r)}function Kn(e){let t=e.domSelectionRange();if(!t.anchorNode)return!1;try{return e.dom.contains(t.anchorNode.nodeType==3?t.anchorNode.parentNode:t.anchorNode)&&(e.editable||e.dom.contains(t.focusNode.nodeType==3?t.focusNode.parentNode:t.focusNode))}catch{return!1}}function Pe(e,t){let{$anchor:n,$head:r}=e.selection,i=t>0?n.max(r):n.min(r),s=i.parent.inlineContent?i.depth?e.doc.resolve(t>0?i.after():i.before()):null:i;return s&&R.findFrom(s,t)}function v(e,t){return e.dispatch(e.state.tr.setSelection(t).scrollIntoView()),!0}function xt(e,t,n){let r=e.state.selection;if(r instanceof b)if(n.indexOf("s")>-1){let{$head:i}=r,s=i.textOffset?null:t<0?i.nodeBefore:i.nodeAfter;if(!s||s.isText||!s.isLeaf)return!1;let o=e.state.doc.resolve(i.pos+s.nodeSize*(t<0?-1:1));return v(e,new b(r.$anchor,o))}else if(r.empty){if(e.endOfTextblock(t>0?"forward":"backward")){let i=Pe(e.state,t);return i&&i instanceof g?v(e,i):!1}else if(!(N&&n.indexOf("m")>-1)){let i=r.$head,s=i.textOffset?null:t<0?i.nodeBefore:i.nodeAfter,o;if(!s||s.isText)return!1;let l=t<0?i.pos-s.nodeSize:i.pos;return s.isAtom||(o=e.docView.descAt(l))&&!o.contentDOM?g.isSelectable(s)?v(e,new g(t<0?e.state.doc.resolve(i.pos-s.nodeSize):i)):$e?v(e,new b(e.state.doc.resolve(t<0?l:l+s.nodeSize))):!1:!1}}else return!1;else{if(r instanceof g&&r.node.isInline)return v(e,new b(t>0?r.$to:r.$from));{let i=Pe(e.state,t);return i?v(e,i):!1}}}function pe(e){return e.nodeType==3?e.nodeValue.length:e.childNodes.length}function se(e,t){let n=e.pmViewDesc;return n&&n.size==0&&(t<0||e.nextSibling||e.nodeName!="BR")}function Q(e,t){return t<0?$n(e):vn(e)}function $n(e){let t=e.domSelectionRange(),n=t.focusNode,r=t.focusOffset;if(!n)return;let i,s,o=!1;for(be&&n.nodeType==1&&r<pe(n)&&se(n.childNodes[r],-1)&&(o=!0);;)if(r>0){if(n.nodeType!=1)break;{let l=n.childNodes[r-1];if(se(l,-1))i=n,s=--r;else if(l.nodeType==3)n=l,r=n.nodeValue.length;else break}}else{if(Ft(n))break;{let l=n.previousSibling;for(;l&&se(l,-1);)i=n.parentNode,s=Y(l),l=l.previousSibling;if(l)n=l,r=pe(n);else{if(n=n.parentNode,n==e.dom)break;r=0}}}o?Ee(e,n,r):i&&Ee(e,i,s)}function vn(e){let t=e.domSelectionRange(),n=t.focusNode,r=t.focusOffset;if(!n)return;let i=pe(n),s,o;for(;;)if(r<i){if(n.nodeType!=1)break;let l=n.childNodes[r];if(se(l,1))s=n,o=++r;else break}else{if(Ft(n))break;{let l=n.nextSibling;for(;l&&se(l,1);)s=l.parentNode,o=Y(l)+1,l=l.nextSibling;if(l)n=l,r=0,i=pe(n);else{if(n=n.parentNode,n==e.dom)break;r=i=0}}}s&&Ee(e,s,o)}function Ft(e){let t=e.pmViewDesc;return t&&t.node&&t.node.isBlock}function qn(e,t){for(;e&&t==e.childNodes.length&&!ze(e);)t=Y(e)+1,e=e.parentNode;for(;e&&t<e.childNodes.length;){let n=e.childNodes[t];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;e=n,t=0}}function _n(e,t){for(;e&&!t&&!ze(e);)t=Y(e),e=e.parentNode;for(;e&&t;){let n=e.childNodes[t-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;e=n,t=e.childNodes.length}}function Ee(e,t,n){if(t.nodeType!=3){let s,o;(o=qn(t,n))?(t=o,n=0):(s=_n(t,n))&&(t=s,n=s.nodeValue.length)}let r=e.domSelection();if(Rt(r)){let s=document.createRange();s.setEnd(t,n),s.setStart(t,n),r.removeAllRanges(),r.addRange(s)}else r.extend&&r.extend(t,n);e.domObserver.setCurSelection();let{state:i}=e;setTimeout(()=>{e.state==i&&ve(e)},50)}function Dt(e,t){let n=e.state.doc.resolve(t);if(!(X||Ln)&&n.parent.inlineContent){let i=e.coordsAtPos(t);if(t>n.start()){let s=e.coordsAtPos(t-1),o=(s.top+s.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(s.left-i.left)>1)return s.left<i.left?"ltr":"rtl"}if(t<n.end()){let s=e.coordsAtPos(t+1),o=(s.top+s.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(s.left-i.left)>1)return s.left>i.left?"ltr":"rtl"}}return getComputedStyle(e.dom).direction=="rtl"?"rtl":"ltr"}function Ot(e,t,n){let r=e.state.selection;if(r instanceof b&&!r.empty||n.indexOf("s")>-1||N&&n.indexOf("m")>-1)return!1;let{$from:i,$to:s}=r;if(!i.parent.inlineContent||e.endOfTextblock(t<0?"up":"down")){let o=Pe(e.state,t);if(o&&o instanceof g)return v(e,o)}if(!i.parent.inlineContent){let o=t<0?i:s,l=r instanceof nt?R.near(o,t):R.findFrom(o,t);return l?v(e,l):!1}return!1}function Tt(e,t){if(!(e.state.selection instanceof b))return!0;let{$head:n,$anchor:r,empty:i}=e.state.selection;if(!n.sameParent(r))return!0;if(!i)return!1;if(e.endOfTextblock(t>0?"forward":"backward"))return!0;let s=!n.textOffset&&(t<0?n.nodeBefore:n.nodeAfter);if(s&&!s.isText){let o=e.state.tr;return t<0?o.delete(n.pos-s.nodeSize,n.pos):o.delete(n.pos,n.pos+s.nodeSize),e.dispatch(o),!0}return!1}function Nt(e,t,n){e.domObserver.stop(),t.contentEditable=n,e.domObserver.start()}function Wn(e){if(!J||e.state.selection.$head.parentOffset>0)return!1;let{focusNode:t,focusOffset:n}=e.domSelectionRange();if(t&&t.nodeType==1&&n==0&&t.firstChild&&t.firstChild.contentEditable=="false"){let r=t.firstChild;Nt(e,r,"true"),setTimeout(()=>Nt(e,r,"false"),20)}return!1}function wn(e){let t="";return e.ctrlKey&&(t+="c"),e.metaKey&&(t+="m"),e.altKey&&(t+="a"),e.shiftKey&&(t+="s"),t}function jn(e,t){let n=t.keyCode,r=wn(t);if(n==8||N&&n==72&&r=="c")return Tt(e,-1)||Q(e,-1);if(n==46&&!t.shiftKey||N&&n==68&&r=="c")return Tt(e,1)||Q(e,1);if(n==13||n==27)return!0;if(n==37||N&&n==66&&r=="c"){let i=n==37?Dt(e,e.state.selection.from)=="ltr"?-1:1:-1;return xt(e,i,r)||Q(e,i)}else if(n==39||N&&n==70&&r=="c"){let i=n==39?Dt(e,e.state.selection.from)=="ltr"?1:-1:1;return xt(e,i,r)||Q(e,i)}else{if(n==38||N&&n==80&&r=="c")return Ot(e,-1,r)||Q(e,-1);if(n==40||N&&n==78&&r=="c")return Wn(e)||Ot(e,1,r)||Q(e,1);if(r==(N?"m":"c")&&(n==66||n==73||n==89||n==90))return!0}return!1}function Kt(e,t){e.someProp("transformCopied",h=>{t=h(t,e)});let n=[],{content:r,openStart:i,openEnd:s}=t;for(;i>1&&s>1&&r.childCount==1&&r.firstChild.childCount==1;){i--,s--;let h=r.firstChild;n.push(h.type.name,h.attrs!=h.type.defaultAttrs?h.attrs:null),r=h.content}let o=e.someProp("clipboardSerializer")||xe.fromSchema(e.state.schema),l=wt(),a=l.createElement("div");a.appendChild(o.serializeFragment(r,{document:l}));let d=a.firstChild,c,u=0;for(;d&&d.nodeType==1&&(c=Wt[d.nodeName.toLowerCase()]);){for(let h=c.length-1;h>=0;h--){let m=l.createElement(c[h]);for(;a.firstChild;)m.appendChild(a.firstChild);a.appendChild(m),u++}d=a.firstChild}d&&d.nodeType==1&&d.setAttribute("data-pm-slice",`${i} ${s}${u?` -${u}`:""} ${JSON.stringify(n)}`);let f=e.someProp("clipboardTextSerializer",h=>h(t,e))||t.content.textBetween(0,t.content.size,`

`);return{dom:a,text:f}}function $t(e,t,n,r,i){let s=i.parent.type.spec.code,o,l;if(!n&&!t)return null;let a=t&&(r||s||!n);if(a){if(e.someProp("transformPastedText",f=>{t=f(t,s||r,e)}),s)return t?new O(P.from(e.state.schema.text(t.replace(/\r\n?/g,`
`))),0,0):O.empty;let u=e.someProp("clipboardTextParser",f=>f(t,i,r,e));if(u)l=u;else{let f=i.marks(),{schema:h}=e.state,m=xe.fromSchema(h);o=document.createElement("div"),t.split(/(?:\r\n?|\n)+/).forEach(I=>{let S=o.appendChild(document.createElement("p"));I&&S.appendChild(m.serializeNode(h.text(I,f)))})}}else e.someProp("transformPastedHTML",u=>{n=u(n,e)}),o=Yn(n),$e&&Xn(o);let d=o&&o.querySelector("[data-pm-slice]"),c=d&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(d.getAttribute("data-pm-slice")||"");if(c&&c[3])for(let u=+c[3];u>0;u--){let f=o.firstChild;for(;f&&f.nodeType!=1;)f=f.nextSibling;if(!f)break;o=f}if(l||(l=(e.someProp("clipboardParser")||e.someProp("domParser")||et.fromSchema(e.state.schema)).parseSlice(o,{preserveWhitespace:!!(a||c),context:i,ruleFromNode(f){return f.nodeName=="BR"&&!f.nextSibling&&f.parentNode&&!Gn.test(f.parentNode.nodeName)?{ignore:!0}:null}})),c)l=Jn(At(l,+c[1],+c[2]),c[4]);else if(l=O.maxOpen(Un(l.content,i),!0),l.openStart||l.openEnd){let u=0,f=0;for(let h=l.content.firstChild;u<l.openStart&&!h.type.spec.isolating;u++,h=h.firstChild);for(let h=l.content.lastChild;f<l.openEnd&&!h.type.spec.isolating;f++,h=h.lastChild);l=At(l,u,f)}return e.someProp("transformPasted",u=>{l=u(l,e)}),l}var Gn=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function Un(e,t){if(e.childCount<2)return e;for(let n=t.depth;n>=0;n--){let i=t.node(n).contentMatchAt(t.index(n)),s,o=[];if(e.forEach(l=>{if(!o)return;let a=i.findWrapping(l.type),d;if(!a)return o=null;if(d=o.length&&s.length&&qt(a,s,l,o[o.length-1],0))o[o.length-1]=d;else{o.length&&(o[o.length-1]=_t(o[o.length-1],s.length));let c=vt(l,a);o.push(c),i=i.matchType(c.type),s=a}}),o)return P.from(o)}return e}function vt(e,t,n=0){for(let r=t.length-1;r>=n;r--)e=t[r].create(null,P.from(e));return e}function qt(e,t,n,r,i){if(i<e.length&&i<t.length&&e[i]==t[i]){let s=qt(e,t,n,r.lastChild,i+1);if(s)return r.copy(r.content.replaceChild(r.childCount-1,s));if(r.contentMatchAt(r.childCount).matchType(i==e.length-1?n.type:e[i+1]))return r.copy(r.content.append(P.from(vt(n,e,i+1))))}}function _t(e,t){if(t==0)return e;let n=e.content.replaceChild(e.childCount-1,_t(e.lastChild,t-1)),r=e.contentMatchAt(e.childCount).fillBefore(P.empty,!0);return e.copy(n.append(r))}function Ie(e,t,n,r,i,s){let o=t<0?e.firstChild:e.lastChild,l=o.content;return e.childCount>1&&(s=0),i<r-1&&(l=Ie(l,t,n,r,i+1,s)),i>=n&&(l=t<0?o.contentMatchAt(0).fillBefore(l,s<=i).append(l):l.append(o.contentMatchAt(o.childCount).fillBefore(P.empty,!0))),e.replaceChild(t<0?0:e.childCount-1,o.copy(l))}function At(e,t,n){return t<e.openStart&&(e=new O(Ie(e.content,-1,t,e.openStart,0,e.openEnd),t,e.openEnd)),n<e.openEnd&&(e=new O(Ie(e.content,1,n,e.openEnd,0,0),e.openStart,n)),e}var Wt={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},Pt=null;function wt(){return Pt||(Pt=document.implementation.createHTMLDocument("title"))}function Yn(e){let t=/^(\s*<meta [^>]*>)*/.exec(e);t&&(e=e.slice(t[0].length));let n=wt().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(e),i;if((i=r&&Wt[r[1].toLowerCase()])&&(e=i.map(s=>"<"+s+">").join("")+e+i.map(s=>"</"+s+">").reverse().join("")),n.innerHTML=e,i)for(let s=0;s<i.length;s++)n=n.querySelector(i[s])||n;return n}function Xn(e){let t=e.querySelectorAll(X?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<t.length;n++){let r=t[n];r.childNodes.length==1&&r.textContent=="\xA0"&&r.parentNode&&r.parentNode.replaceChild(e.ownerDocument.createTextNode(" "),r)}}function Jn(e,t){if(!e.size)return e;let n=e.content.firstChild.type.schema,r;try{r=JSON.parse(t)}catch{return e}let{content:i,openStart:s,openEnd:o}=e;for(let l=r.length-2;l>=0;l-=2){let a=n.nodes[r[l]];if(!a||a.hasRequiredAttrs())break;i=P.from(a.create(r[l+1],i)),s++,o++}return new O(i,s,o)}var E={},D={};function q(e,t){e.input.lastSelectionOrigin=t,e.input.lastSelectionTime=Date.now()}D.keydown=(e,t)=>{let n=t;if(e.input.shiftKey=n.keyCode==16||n.shiftKey,!Gt(e,n)&&(e.input.lastKeyCode=n.keyCode,e.input.lastKeyCodeTime=Date.now(),!(ae&&X&&n.keyCode==13)))if(n.keyCode!=229&&e.domObserver.forceFlush(),Ke&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let r=Date.now();e.input.lastIOSEnter=r,e.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{e.input.lastIOSEnter==r&&(e.someProp("handleKeyDown",i=>i(e,Lt(13,"Enter"))),e.input.lastIOSEnter=0)},200)}else e.someProp("handleKeyDown",r=>r(e,n))||jn(e,n)?n.preventDefault():q(e,"key")};D.keyup=(e,t)=>{t.keyCode==16&&(e.input.shiftKey=!1)};D.keypress=(e,t)=>{let n=t;if(Gt(e,n)||!n.charCode||n.ctrlKey&&!n.altKey||N&&n.metaKey)return;if(e.someProp("handleKeyPress",i=>i(e,n))){n.preventDefault();return}let r=e.state.selection;if(!(r instanceof b)||!r.$from.sameParent(r.$to)){let i=String.fromCharCode(n.charCode);!/[\r\n]/.test(i)&&!e.someProp("handleTextInput",s=>s(e,r.$from.pos,r.$to.pos,i))&&e.dispatch(e.state.tr.insertText(i).scrollIntoView()),n.preventDefault()}};function Me(e){return{left:e.clientX,top:e.clientY}}function Zn(e,t){let n=t.x-e.clientX,r=t.y-e.clientY;return n*n+r*r<100}function qe(e,t,n,r,i){if(r==-1)return!1;let s=e.state.doc.resolve(r);for(let o=s.depth+1;o>0;o--)if(e.someProp(t,l=>o>s.depth?l(e,n,s.nodeAfter,s.before(o),i,!0):l(e,n,s.node(o),s.before(o),i,!1)))return!0;return!1}function te(e,t,n){e.focused||e.focus();let r=e.state.tr.setSelection(t);n=="pointer"&&r.setMeta("pointer",!0),e.dispatch(r)}function Qn(e,t){if(t==-1)return!1;let n=e.state.doc.resolve(t),r=n.nodeAfter;return r&&r.isAtom&&g.isSelectable(r)?(te(e,new g(n),"pointer"),!0):!1}function er(e,t){if(t==-1)return!1;let n=e.state.selection,r,i;n instanceof g&&(r=n.node);let s=e.state.doc.resolve(t);for(let o=s.depth+1;o>0;o--){let l=o>s.depth?s.nodeAfter:s.node(o);if(g.isSelectable(l)){r&&n.$from.depth>0&&o>=n.$from.depth&&s.before(n.$from.depth+1)==n.$from.pos?i=s.before(n.$from.depth):i=s.before(o);break}}return i!=null?(te(e,g.create(e.state.doc,i),"pointer"),!0):!1}function tr(e,t,n,r,i){return qe(e,"handleClickOn",t,n,r)||e.someProp("handleClick",s=>s(e,t,r))||(i?er(e,n):Qn(e,n))}function nr(e,t,n,r){return qe(e,"handleDoubleClickOn",t,n,r)||e.someProp("handleDoubleClick",i=>i(e,t,r))}function rr(e,t,n,r){return qe(e,"handleTripleClickOn",t,n,r)||e.someProp("handleTripleClick",i=>i(e,t,r))||ir(e,n,r)}function ir(e,t,n){if(n.button!=0)return!1;let r=e.state.doc;if(t==-1)return r.inlineContent?(te(e,b.create(r,0,r.content.size),"pointer"),!0):!1;let i=r.resolve(t);for(let s=i.depth+1;s>0;s--){let o=s>i.depth?i.nodeAfter:i.node(s),l=i.before(s);if(o.inlineContent)te(e,b.create(r,l+1,l+1+o.content.size),"pointer");else if(g.isSelectable(o))te(e,g.create(r,l),"pointer");else continue;return!0}}function _e(e){return me(e)}var jt=N?"metaKey":"ctrlKey";E.mousedown=(e,t)=>{let n=t;e.input.shiftKey=n.shiftKey;let r=_e(e),i=Date.now(),s="singleClick";i-e.input.lastClick.time<500&&Zn(n,e.input.lastClick)&&!n[jt]&&(e.input.lastClick.type=="singleClick"?s="doubleClick":e.input.lastClick.type=="doubleClick"&&(s="tripleClick")),e.input.lastClick={time:i,x:n.clientX,y:n.clientY,type:s};let o=e.posAtCoords(Me(n));o&&(s=="singleClick"?(e.input.mouseDown&&e.input.mouseDown.done(),e.input.mouseDown=new Re(e,o,n,!!r)):(s=="doubleClick"?nr:rr)(e,o.pos,o.inside,n)?n.preventDefault():q(e,"pointer"))};var Re=class{constructor(t,n,r,i){this.view=t,this.pos=n,this.event=r,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=t.state.doc,this.selectNode=!!r[jt],this.allowDefault=r.shiftKey;let s,o;if(n.inside>-1)s=t.state.doc.nodeAt(n.inside),o=n.inside;else{let c=t.state.doc.resolve(n.pos);s=c.parent,o=c.depth?c.before():0}let l=i?null:r.target,a=l?t.docView.nearestDesc(l,!0):null;this.target=a?a.dom:null;let{selection:d}=t.state;(r.button==0&&s.type.spec.draggable&&s.type.spec.selectable!==!1||d instanceof g&&d.from<=o&&d.to>o)&&(this.mightDrag={node:s,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&be&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),t.root.addEventListener("mouseup",this.up=this.up.bind(this)),t.root.addEventListener("mousemove",this.move=this.move.bind(this)),q(t,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>ve(this.view)),this.view.input.mouseDown=null}up(t){if(this.done(),!this.view.dom.contains(t.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(Me(t))),this.updateAllowDefault(t),this.allowDefault||!n?q(this.view,"pointer"):tr(this.view,n.pos,n.inside,t,this.selectNode)?t.preventDefault():t.button==0&&(this.flushed||J&&this.mightDrag&&!this.mightDrag.node.isAtom||X&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(te(this.view,R.near(this.view.state.doc.resolve(n.pos)),"pointer"),t.preventDefault()):q(this.view,"pointer")}move(t){this.updateAllowDefault(t),q(this.view,"pointer"),t.buttons==0&&this.done()}updateAllowDefault(t){!this.allowDefault&&(Math.abs(this.event.x-t.clientX)>4||Math.abs(this.event.y-t.clientY)>4)&&(this.allowDefault=!0)}};E.touchstart=e=>{e.input.lastTouch=Date.now(),_e(e),q(e,"pointer")};E.touchmove=e=>{e.input.lastTouch=Date.now(),q(e,"pointer")};E.contextmenu=e=>_e(e);function Gt(e,t){return e.composing?!0:J&&Math.abs(t.timeStamp-e.input.compositionEndedAt)<500?(e.input.compositionEndedAt=-2e8,!0):!1}var sr=ae?5e3:-1;D.compositionstart=D.compositionupdate=e=>{if(!e.composing){e.domObserver.flush();let{state:t}=e,n=t.selection.$from;if(t.selection.empty&&(t.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)))e.markCursor=e.state.storedMarks||n.marks(),me(e,!0),e.markCursor=null;else if(me(e),be&&t.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let r=e.domSelectionRange();for(let i=r.focusNode,s=r.focusOffset;i&&i.nodeType==1&&s!=0;){let o=s<0?i.lastChild:i.childNodes[s-1];if(!o)break;if(o.nodeType==3){e.domSelection().collapse(o,o.nodeValue.length);break}else i=o,s=-1}}e.input.composing=!0}Ut(e,sr)};D.compositionend=(e,t)=>{e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=t.timeStamp,e.input.compositionPendingChanges=e.domObserver.pendingRecords().length?e.input.compositionID:0,e.input.compositionPendingChanges&&Promise.resolve().then(()=>e.domObserver.flush()),e.input.compositionID++,Ut(e,20))};function Ut(e,t){clearTimeout(e.input.composingTimeout),t>-1&&(e.input.composingTimeout=setTimeout(()=>me(e),t))}function or(e){for(e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=lr());e.input.compositionNodes.length>0;)e.input.compositionNodes.pop().markParentsDirty()}function lr(){let e=document.createEvent("Event");return e.initEvent("event",!0,!0),e.timeStamp}function me(e,t=!1){if(!(ae&&e.domObserver.flushingSoon>=0)){if(e.domObserver.forceFlush(),or(e),t||e.docView&&e.docView.dirty){let n=Vn(e);return n&&!n.eq(e.state.selection)?e.dispatch(e.state.tr.setSelection(n)):e.updateState(e.state),!0}return!1}}function ar(e,t){if(!e.dom.parentNode)return;let n=e.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(t),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),i=document.createRange();i.selectNodeContents(t),e.dom.blur(),r.removeAllRanges(),r.addRange(i),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),e.focus()},50)}var oe=ne&&Fe<15||Ke&&Bn<604;E.copy=D.cut=(e,t)=>{let n=t,r=e.state.selection,i=n.type=="cut";if(r.empty)return;let s=oe?null:n.clipboardData,o=r.content(),{dom:l,text:a}=Kt(e,o);s?(n.preventDefault(),s.clearData(),s.setData("text/html",l.innerHTML),s.setData("text/plain",a)):ar(e,l),i&&e.dispatch(e.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function dr(e){return e.openStart==0&&e.openEnd==0&&e.content.childCount==1?e.content.firstChild:null}function cr(e,t){if(!e.dom.parentNode)return;let n=e.input.shiftKey||e.state.selection.$from.parent.type.spec.code,r=e.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let i=e.input.shiftKey&&e.input.lastKeyCode!=45;setTimeout(()=>{e.focus(),r.parentNode&&r.parentNode.removeChild(r),n?Le(e,r.value,null,i,t):Le(e,r.textContent,r.innerHTML,i,t)},50)}function Le(e,t,n,r,i){let s=$t(e,t,n,r,e.state.selection.$from);if(e.someProp("handlePaste",a=>a(e,i,s||O.empty)))return!0;if(!s)return!1;let o=dr(s),l=o?e.state.tr.replaceSelectionWith(o,r):e.state.tr.replaceSelection(s);return e.dispatch(l.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function Yt(e){let t=e.getData("text/plain")||e.getData("Text");if(t)return t;let n=e.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}D.paste=(e,t)=>{let n=t;if(e.composing&&!ae)return;let r=oe?null:n.clipboardData,i=e.input.shiftKey&&e.input.lastKeyCode!=45;r&&Le(e,Yt(r),r.getData("text/html"),i,n)?n.preventDefault():cr(e,n)};var Be=class{constructor(t,n,r){this.slice=t,this.move=n,this.node=r}},Xt=N?"altKey":"ctrlKey";E.dragstart=(e,t)=>{let n=t,r=e.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let i=e.state.selection,s=i.empty?null:e.posAtCoords(Me(n)),o;if(!(s&&s.pos>=i.from&&s.pos<=(i instanceof g?i.to-1:i.to))){if(r&&r.mightDrag)o=g.create(e.state.doc,r.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let c=e.docView.nearestDesc(n.target,!0);c&&c.node.type.spec.draggable&&c!=e.docView&&(o=g.create(e.state.doc,c.posBefore))}}let l=(o||e.state.selection).content(),{dom:a,text:d}=Kt(e,l);n.dataTransfer.clearData(),n.dataTransfer.setData(oe?"Text":"text/html",a.innerHTML),n.dataTransfer.effectAllowed="copyMove",oe||n.dataTransfer.setData("text/plain",d),e.dragging=new Be(l,!n[Xt],o)};E.dragend=e=>{let t=e.dragging;window.setTimeout(()=>{e.dragging==t&&(e.dragging=null)},50)};D.dragover=D.dragenter=(e,t)=>t.preventDefault();D.drop=(e,t)=>{let n=t,r=e.dragging;if(e.dragging=null,!n.dataTransfer)return;let i=e.posAtCoords(Me(n));if(!i)return;let s=e.state.doc.resolve(i.pos),o=r&&r.slice;o?e.someProp("transformPasted",m=>{o=m(o,e)}):o=$t(e,Yt(n.dataTransfer),oe?null:n.dataTransfer.getData("text/html"),!1,s);let l=!!(r&&!n[Xt]);if(e.someProp("handleDrop",m=>m(e,n,o||O.empty,l))){n.preventDefault();return}if(!o)return;n.preventDefault();let a=o?ue(e.state.doc,s.pos,o):s.pos;a==null&&(a=s.pos);let d=e.state.tr;if(l){let{node:m}=r;m?m.replace(d):d.deleteSelection()}let c=d.mapping.map(a),u=o.openStart==0&&o.openEnd==0&&o.content.childCount==1,f=d.doc;if(u?d.replaceRangeWith(c,c,o.content.firstChild):d.replaceRange(c,c,o),d.doc.eq(f))return;let h=d.doc.resolve(c);if(u&&g.isSelectable(o.content.firstChild)&&h.nodeAfter&&h.nodeAfter.sameMarkup(o.content.firstChild))d.setSelection(new g(h));else{let m=d.mapping.map(a);d.mapping.maps[d.mapping.maps.length-1].forEach((I,S,A,de)=>m=de),d.setSelection(zt(e,h,d.doc.resolve(m)))}e.focus(),e.dispatch(d.setMeta("uiEvent","drop"))};E.focus=e=>{e.input.lastFocus=Date.now(),e.focused||(e.domObserver.stop(),e.dom.classList.add("ProseMirror-focused"),e.domObserver.start(),e.focused=!0,setTimeout(()=>{e.docView&&e.hasFocus()&&!e.domObserver.currentSelection.eq(e.domSelectionRange())&&ve(e)},20))};E.blur=(e,t)=>{let n=t;e.focused&&(e.domObserver.stop(),e.dom.classList.remove("ProseMirror-focused"),e.domObserver.start(),n.relatedTarget&&e.dom.contains(n.relatedTarget)&&e.domObserver.currentSelection.clear(),e.focused=!1)};E.beforeinput=(e,t)=>{if(X&&ae&&t.inputType=="deleteContentBackward"){e.domObserver.flushSoon();let{domChangeCount:r}=e.input;setTimeout(()=>{if(e.input.domChangeCount!=r||(e.dom.blur(),e.focus(),e.someProp("handleKeyDown",s=>s(e,Lt(8,"Backspace")))))return;let{$cursor:i}=e.state.selection;i&&i.pos>0&&e.dispatch(e.state.tr.delete(i.pos-1,i.pos).scrollIntoView())},50)}};for(let e in D)E[e]=D[e];function le(e,t){if(e==t)return!0;for(let n in e)if(e[n]!==t[n])return!1;for(let n in t)if(!(n in e))return!1;return!0}var ge=class e{constructor(t,n){this.toDOM=t,this.spec=n||G,this.side=this.spec.side||0}map(t,n,r,i){let{pos:s,deleted:o}=t.mapResult(n.from+i,this.side<0?-1:1);return o?null:new _(s-r,s-r,this)}valid(){return!0}eq(t){return this==t||t instanceof e&&(this.spec.key&&this.spec.key==t.spec.key||this.toDOM==t.toDOM&&le(this.spec,t.spec))}destroy(t){this.spec.destroy&&this.spec.destroy(t)}},j=class e{constructor(t,n){this.attrs=t,this.spec=n||G}map(t,n,r,i){let s=t.map(n.from+i,this.spec.inclusiveStart?-1:1)-r,o=t.map(n.to+i,this.spec.inclusiveEnd?1:-1)-r;return s>=o?null:new _(s,o,this)}valid(t,n){return n.from<n.to}eq(t){return this==t||t instanceof e&&le(this.attrs,t.attrs)&&le(this.spec,t.spec)}static is(t){return t.type instanceof e}destroy(){}},Ve=class e{constructor(t,n){this.attrs=t,this.spec=n||G}map(t,n,r,i){let s=t.mapResult(n.from+i,1);if(s.deleted)return null;let o=t.mapResult(n.to+i,-1);return o.deleted||o.pos<=s.pos?null:new _(s.pos-r,o.pos-r,this)}valid(t,n){let{index:r,offset:i}=t.content.findIndex(n.from),s;return i==n.from&&!(s=t.child(r)).isText&&i+s.nodeSize==n.to}eq(t){return this==t||t instanceof e&&le(this.attrs,t.attrs)&&le(this.spec,t.spec)}destroy(){}},_=class e{constructor(t,n,r){this.from=t,this.to=n,this.type=r}copy(t,n){return new e(t,n,this.type)}eq(t,n=0){return this.type.eq(t.type)&&this.from+n==t.from&&this.to+n==t.to}map(t,n,r){return this.type.map(t,this,n,r)}static widget(t,n,r){return new e(t,t,new ge(n,r))}static inline(t,n,r,i){return new e(t,n,new j(r,i))}static node(t,n,r,i){return new e(t,n,new Ve(r,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof j}get widget(){return this.type instanceof ge}},ee=[],G={},x=class e{constructor(t,n){this.local=t.length?t:ee,this.children=n.length?n:ee}static create(t,n){return n.length?ye(n,t,0,G):k}find(t,n,r){let i=[];return this.findInner(t??0,n??1e9,i,0,r),i}findInner(t,n,r,i,s){for(let o=0;o<this.local.length;o++){let l=this.local[o];l.from<=n&&l.to>=t&&(!s||s(l.spec))&&r.push(l.copy(l.from+i,l.to+i))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<n&&this.children[o+1]>t){let l=this.children[o]+1;this.children[o+2].findInner(t-l,n-l,r,i+l,s)}}map(t,n,r){return this==k||t.maps.length==0?this:this.mapInner(t,n,0,0,r||G)}mapInner(t,n,r,i,s){let o;for(let l=0;l<this.local.length;l++){let a=this.local[l].map(t,r,i);a&&a.type.valid(n,a)?(o||(o=[])).push(a):s.onRemove&&s.onRemove(this.local[l].spec)}return this.children.length?ur(this.children,o||[],t,n,r,i,s):o?new e(o.sort(U),ee):k}add(t,n){return n.length?this==k?e.create(t,n):this.addInner(t,n,0):this}addInner(t,n,r){let i,s=0;t.forEach((l,a)=>{let d=a+r,c;if(c=Zt(n,l,d)){for(i||(i=this.children.slice());s<i.length&&i[s]<a;)s+=3;i[s]==a?i[s+2]=i[s+2].addInner(l,c,d+1):i.splice(s,0,a,a+l.nodeSize,ye(c,l,d+1,G)),s+=3}});let o=Jt(s?Qt(n):n,-r);for(let l=0;l<o.length;l++)o[l].type.valid(t,o[l])||o.splice(l--,1);return new e(o.length?this.local.concat(o).sort(U):this.local,i||this.children)}remove(t){return t.length==0||this==k?this:this.removeInner(t,0)}removeInner(t,n){let r=this.children,i=this.local;for(let s=0;s<r.length;s+=3){let o,l=r[s]+n,a=r[s+1]+n;for(let c=0,u;c<t.length;c++)(u=t[c])&&u.from>l&&u.to<a&&(t[c]=null,(o||(o=[])).push(u));if(!o)continue;r==this.children&&(r=this.children.slice());let d=r[s+2].removeInner(o,l+1);d!=k?r[s+2]=d:(r.splice(s,3),s-=3)}if(i.length){for(let s=0,o;s<t.length;s++)if(o=t[s])for(let l=0;l<i.length;l++)i[l].eq(o,n)&&(i==this.local&&(i=this.local.slice()),i.splice(l--,1))}return r==this.children&&i==this.local?this:i.length||r.length?new e(i,r):k}forChild(t,n){if(this==k)return this;if(n.isLeaf)return e.empty;let r,i;for(let l=0;l<this.children.length;l+=3)if(this.children[l]>=t){this.children[l]==t&&(r=this.children[l+2]);break}let s=t+1,o=s+n.content.size;for(let l=0;l<this.local.length;l++){let a=this.local[l];if(a.from<o&&a.to>s&&a.type instanceof j){let d=Math.max(s,a.from)-s,c=Math.min(o,a.to)-s;d<c&&(i||(i=[])).push(a.copy(d,c))}}if(i){let l=new e(i.sort(U),ee);return r?new He([l,r]):l}return r||k}eq(t){if(this==t)return!0;if(!(t instanceof e)||this.local.length!=t.local.length||this.children.length!=t.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(t.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=t.children[n]||this.children[n+1]!=t.children[n+1]||!this.children[n+2].eq(t.children[n+2]))return!1;return!0}locals(t){return We(this.localsInner(t))}localsInner(t){if(this==k)return ee;if(t.inlineContent||!this.local.some(j.is))return this.local;let n=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof j||n.push(this.local[r]);return n}};x.empty=new x([],[]);x.removeOverlap=We;var k=x.empty,He=class e{constructor(t){this.members=t}map(t,n){let r=this.members.map(i=>i.map(t,n,G));return e.from(r)}forChild(t,n){if(n.isLeaf)return x.empty;let r=[];for(let i=0;i<this.members.length;i++){let s=this.members[i].forChild(t,n);s!=k&&(s instanceof e?r=r.concat(s.members):r.push(s))}return e.from(r)}eq(t){if(!(t instanceof e)||t.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(t.members[n]))return!1;return!0}locals(t){let n,r=!0;for(let i=0;i<this.members.length;i++){let s=this.members[i].localsInner(t);if(s.length)if(!n)n=s;else{r&&(n=n.slice(),r=!1);for(let o=0;o<s.length;o++)n.push(s[o])}}return n?We(r?n:n.sort(U)):ee}static from(t){switch(t.length){case 0:return k;case 1:return t[0];default:return new e(t.every(n=>n instanceof x)?t:t.reduce((n,r)=>n.concat(r instanceof x?r:r.members),[]))}}};function ur(e,t,n,r,i,s,o){let l=e.slice();for(let d=0,c=s;d<n.maps.length;d++){let u=0;n.maps[d].forEach((f,h,m,I)=>{let S=I-m-(h-f);for(let A=0;A<l.length;A+=3){let de=l[A+1];if(de<0||f>de+c-u)continue;let Je=l[A]+c-u;h>=Je?l[A+1]=f<=Je?-2:-1:f>=c&&S&&(l[A]+=S,l[A+1]+=S)}u+=S}),c=n.maps[d].map(c,-1)}let a=!1;for(let d=0;d<l.length;d+=3)if(l[d+1]<0){if(l[d+1]==-2){a=!0,l[d+1]=-1;continue}let c=n.map(e[d]+s),u=c-i;if(u<0||u>=r.content.size){a=!0;continue}let f=n.map(e[d+1]+s,-1),h=f-i,{index:m,offset:I}=r.content.findIndex(u),S=r.maybeChild(m);if(S&&I==u&&I+S.nodeSize==h){let A=l[d+2].mapInner(n,S,c+1,e[d]+s+1,o);A!=k?(l[d]=u,l[d+1]=h,l[d+2]=A):(l[d+1]=-2,a=!0)}else a=!0}if(a){let d=fr(l,e,t,n,i,s,o),c=ye(d,r,0,o);t=c.local;for(let u=0;u<l.length;u+=3)l[u+1]<0&&(l.splice(u,3),u-=3);for(let u=0,f=0;u<c.children.length;u+=3){let h=c.children[u];for(;f<l.length&&l[f]<h;)f+=3;l.splice(f,0,c.children[u],c.children[u+1],c.children[u+2])}}return new x(t.sort(U),l)}function Jt(e,t){if(!t||!e.length)return e;let n=[];for(let r=0;r<e.length;r++){let i=e[r];n.push(new _(i.from+t,i.to+t,i.type))}return n}function fr(e,t,n,r,i,s,o){function l(a,d){for(let c=0;c<a.local.length;c++){let u=a.local[c].map(r,i,d);u?n.push(u):o.onRemove&&o.onRemove(a.local[c].spec)}for(let c=0;c<a.children.length;c+=3)l(a.children[c+2],a.children[c]+d+1)}for(let a=0;a<e.length;a+=3)e[a+1]==-1&&l(e[a+2],t[a]+s+1);return n}function Zt(e,t,n){if(t.isLeaf)return null;let r=n+t.nodeSize,i=null;for(let s=0,o;s<e.length;s++)(o=e[s])&&o.from>n&&o.to<r&&((i||(i=[])).push(o),e[s]=null);return i}function Qt(e){let t=[];for(let n=0;n<e.length;n++)e[n]!=null&&t.push(e[n]);return t}function ye(e,t,n,r){let i=[],s=!1;t.forEach((l,a)=>{let d=Zt(e,l,a+n);if(d){s=!0;let c=ye(d,l,n+a+1,r);c!=k&&i.push(a,a+l.nodeSize,c)}});let o=Jt(s?Qt(e):e,-n).sort(U);for(let l=0;l<o.length;l++)o[l].type.valid(t,o[l])||(r.onRemove&&r.onRemove(o[l].spec),o.splice(l--,1));return o.length||i.length?new x(o,i):k}function U(e,t){return e.from-t.from||e.to-t.to}function We(e){let t=e;for(let n=0;n<t.length-1;n++){let r=t[n];if(r.from!=r.to)for(let i=n+1;i<t.length;i++){let s=t[i];if(s.from==r.from){s.to!=r.to&&(t==e&&(t=e.slice()),t[i]=s.copy(s.from,r.to),Et(t,i+1,s.copy(r.to,s.to)));continue}else{s.from<r.to&&(t==e&&(t=e.slice()),t[n]=r.copy(r.from,s.from),Et(t,i,r.copy(s.from,r.to)));break}}}return t}function Et(e,t,n){for(;t<e.length&&U(n,e[t])>0;)t++;e.splice(t,0,n)}var si=ne&&Fe<=11;var C=class e extends R{constructor(t){super(t,t)}map(t,n){let r=t.resolve(n.map(this.head));return e.valid(r)?new e(r):R.near(r)}content(){return O.empty}eq(t){return t instanceof e&&t.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(t,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new e(t.resolve(n.pos))}getBookmark(){return new we(this.anchor)}static valid(t){let n=t.parent;if(n.isTextblock||!hr(t)||!pr(t))return!1;let r=n.type.spec.allowGapCursor;if(r!=null)return r;let i=n.contentMatchAt(t.index()).defaultType;return i&&i.isTextblock}static findGapCursorFrom(t,n,r=!1){e:for(;;){if(!r&&e.valid(t))return t;let i=t.pos,s=null;for(let o=t.depth;;o--){let l=t.node(o);if(n>0?t.indexAfter(o)<l.childCount:t.index(o)>0){s=l.child(n>0?t.indexAfter(o):t.index(o)-1);break}else if(o==0)return null;i+=n;let a=t.doc.resolve(i);if(e.valid(a))return a}for(;;){let o=n>0?s.firstChild:s.lastChild;if(!o){if(s.isAtom&&!s.isText&&!g.isSelectable(s)){t=t.doc.resolve(i+s.nodeSize*n),r=!1;continue e}break}s=o,i+=n;let l=t.doc.resolve(i);if(e.valid(l))return l}return null}}};C.prototype.visible=!1;C.findFrom=C.findGapCursorFrom;R.jsonID("gapcursor",C);var we=class e{constructor(t){this.pos=t}map(t){return new e(t.map(this.pos))}resolve(t){let n=t.resolve(this.pos);return C.valid(n)?new C(n):R.near(n)}};function hr(e){for(let t=e.depth;t>=0;t--){let n=e.index(t),r=e.node(t);if(n==0){if(r.type.spec.isolating)return!0;continue}for(let i=r.child(n-1);;i=i.lastChild){if(i.childCount==0&&!i.inlineContent||i.isAtom||i.type.spec.isolating)return!0;if(i.inlineContent)return!1}}return!0}function pr(e){for(let t=e.depth;t>=0;t--){let n=e.indexAfter(t),r=e.node(t);if(n==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let i=r.child(n);;i=i.firstChild){if(i.childCount==0&&!i.inlineContent||i.isAtom||i.type.spec.isolating)return!0;if(i.inlineContent)return!1}}return!0}function en(){return new F({props:{decorations:br,createSelectionBetween(e,t,n){return t.pos==n.pos&&C.valid(n)?new C(n):null},handleClick:gr,handleKeyDown:mr,handleDOMEvents:{beforeinput:yr}}})}var mr=rt({ArrowLeft:Ce("horiz",-1),ArrowRight:Ce("horiz",1),ArrowUp:Ce("vert",-1),ArrowDown:Ce("vert",1)});function Ce(e,t){let n=e=="vert"?t>0?"down":"up":t>0?"right":"left";return function(r,i,s){let o=r.selection,l=t>0?o.$to:o.$from,a=o.empty;if(o instanceof b){if(!s.endOfTextblock(n)||l.depth==0)return!1;a=!1,l=r.doc.resolve(t>0?l.after():l.before())}let d=C.findGapCursorFrom(l,t,a);return d?(i&&i(r.tr.setSelection(new C(d))),!0):!1}}function gr(e,t,n){if(!e||!e.editable)return!1;let r=e.state.doc.resolve(t);if(!C.valid(r))return!1;let i=e.posAtCoords({left:n.clientX,top:n.clientY});return i&&i.inside>-1&&g.isSelectable(e.state.doc.nodeAt(i.inside))?!1:(e.dispatch(e.state.tr.setSelection(new C(r))),!0)}function yr(e,t){if(t.inputType!="insertCompositionText"||!(e.state.selection instanceof C))return!1;let{$from:n}=e.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(e.state.schema.nodes.text);if(!r)return!1;let i=P.empty;for(let o=r.length-1;o>=0;o--)i=P.from(r[o].createAndFill(null,i));let s=e.state.tr.replace(n.pos,n.pos,new O(i,0,0));return s.setSelection(b.near(s.doc.resolve(n.pos+1))),e.dispatch(s),!1}function br(e){if(!(e.selection instanceof C))return null;let t=document.createElement("div");return t.className="ProseMirror-gapcursor",x.create(e.doc,[_.widget(e.selection.head,t,{key:"gapcursor"})])}var tn=K.create({name:"gapCursor",addProseMirrorPlugins(){return[en()]},extendNodeSchema(e){var t;let n={name:e.name,options:e.options,storage:e.storage};return{allowGapCursor:(t=st(it(e,"allowGapCursor",n)))!==null&&t!==void 0?t:null}}});var nn=y.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:e}){return["br",p(this.options.HTMLAttributes,e)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:e,chain:t,state:n,editor:r})=>e.first([()=>e.exitCode(),()=>e.command(()=>{let{selection:i,storedMarks:s}=n;if(i.$from.parent.type.spec.isolating)return!1;let{keepMarks:o}=this.options,{splittableMarks:l}=r.extensionManager,a=s||i.$to.parentOffset&&i.$from.marks();return t().insertContent({type:this.name}).command(({tr:d,dispatch:c})=>{if(c&&a&&o){let u=a.filter(f=>l.includes(f.type.name));d.ensureMarks(u)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}});var rn=y.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(e=>({tag:`h${e}`,attrs:{level:e}}))},renderHTML({node:e,HTMLAttributes:t}){return[`h${this.options.levels.includes(e.attrs.level)?e.attrs.level:this.options.levels[0]}`,p(this.options.HTMLAttributes,t),0]},addCommands(){return{setHeading:e=>({commands:t})=>this.options.levels.includes(e.level)?t.setNode(this.name,e):!1,toggleHeading:e=>({commands:t})=>this.options.levels.includes(e.level)?t.toggleNode(this.name,"paragraph",e):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((e,t)=>Ze(ce({},e),{[`Mod-Alt-${t}`]:()=>this.editor.commands.toggleHeading({level:t})}),{})},addInputRules(){return this.options.levels.map(e=>ie({find:new RegExp(`^(#{1,${e}})\\s$`),type:this.type,getAttributes:{level:e}}))}});var ke=200,M=function(){};M.prototype.append=function(t){return t.length?(t=M.from(t),!this.length&&t||t.length<ke&&this.leafAppend(t)||this.length<ke&&t.leafPrepend(this)||this.appendInner(t)):this};M.prototype.prepend=function(t){return t.length?M.from(t).append(this):this};M.prototype.appendInner=function(t){return new Mr(this,t)};M.prototype.slice=function(t,n){return t===void 0&&(t=0),n===void 0&&(n=this.length),t>=n?M.empty:this.sliceInner(Math.max(0,t),Math.min(this.length,n))};M.prototype.get=function(t){if(!(t<0||t>=this.length))return this.getInner(t)};M.prototype.forEach=function(t,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length),n<=r?this.forEachInner(t,n,r,0):this.forEachInvertedInner(t,n,r,0)};M.prototype.map=function(t,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length);var i=[];return this.forEach(function(s,o){return i.push(t(s,o))},n,r),i};M.from=function(t){return t instanceof M?t:t&&t.length?new sn(t):M.empty};var sn=function(e){function t(r){e.call(this),this.values=r}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={length:{configurable:!0},depth:{configurable:!0}};return t.prototype.flatten=function(){return this.values},t.prototype.sliceInner=function(i,s){return i==0&&s==this.length?this:new t(this.values.slice(i,s))},t.prototype.getInner=function(i){return this.values[i]},t.prototype.forEachInner=function(i,s,o,l){for(var a=s;a<o;a++)if(i(this.values[a],l+a)===!1)return!1},t.prototype.forEachInvertedInner=function(i,s,o,l){for(var a=s-1;a>=o;a--)if(i(this.values[a],l+a)===!1)return!1},t.prototype.leafAppend=function(i){if(this.length+i.length<=ke)return new t(this.values.concat(i.flatten()))},t.prototype.leafPrepend=function(i){if(this.length+i.length<=ke)return new t(i.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(t.prototype,n),t}(M);M.empty=new sn([]);var Mr=function(e){function t(n,r){e.call(this),this.left=n,this.right=r,this.length=n.length+r.length,this.depth=Math.max(n.depth,r.depth)+1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},t.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},t.prototype.forEachInner=function(r,i,s,o){var l=this.left.length;if(i<l&&this.left.forEachInner(r,i,Math.min(s,l),o)===!1||s>l&&this.right.forEachInner(r,Math.max(i-l,0),Math.min(this.length,s)-l,o+l)===!1)return!1},t.prototype.forEachInvertedInner=function(r,i,s,o){var l=this.left.length;if(i>l&&this.right.forEachInvertedInner(r,i-l,Math.max(s,l)-l,o+l)===!1||s<l&&this.left.forEachInvertedInner(r,Math.min(i,l),s,o)===!1)return!1},t.prototype.sliceInner=function(r,i){if(r==0&&i==this.length)return this;var s=this.left.length;return i<=s?this.left.slice(r,i):r>=s?this.right.slice(r-s,i-s):this.left.slice(r,s).append(this.right.slice(0,i-s))},t.prototype.leafAppend=function(r){var i=this.right.leafAppend(r);if(i)return new t(this.left,i)},t.prototype.leafPrepend=function(r){var i=this.left.leafPrepend(r);if(i)return new t(i,this.right)},t.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new t(this.left,new t(this.right,r)):new t(this,r)},t}(M),je=M;var Cr=500,Z=class e{constructor(t,n){this.items=t,this.eventCount=n}popEvent(t,n){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let i,s;n&&(i=this.remapping(r,this.items.length),s=i.maps.length);let o=t.tr,l,a,d=[],c=[];return this.items.forEach((u,f)=>{if(!u.step){i||(i=this.remapping(r,f+1),s=i.maps.length),s--,c.push(u);return}if(i){c.push(new H(u.map));let h=u.step.map(i.slice(s)),m;h&&o.maybeStep(h).doc&&(m=o.mapping.maps[o.mapping.maps.length-1],d.push(new H(m,void 0,void 0,d.length+c.length))),s--,m&&i.appendMap(m,s)}else o.maybeStep(u.step);if(u.selection)return l=i?u.selection.map(i.slice(s)):u.selection,a=new e(this.items.slice(0,r).append(c.reverse().concat(d)),this.eventCount-1),!1},this.items.length,0),{remaining:a,transform:o,selection:l}}addTransform(t,n,r,i){let s=[],o=this.eventCount,l=this.items,a=!i&&l.length?l.get(l.length-1):null;for(let c=0;c<t.steps.length;c++){let u=t.steps[c].invert(t.docs[c]),f=new H(t.mapping.maps[c],u,n),h;(h=a&&a.merge(f))&&(f=h,c?s.pop():l=l.slice(0,l.length-1)),s.push(f),n&&(o++,n=void 0),i||(a=f)}let d=o-r.depth;return d>Sr&&(l=kr(l,d),o-=d),new e(l.append(s),o)}remapping(t,n){let r=new tt;return this.items.forEach((i,s)=>{let o=i.mirrorOffset!=null&&s-i.mirrorOffset>=t?r.maps.length-i.mirrorOffset:void 0;r.appendMap(i.map,o)},t,n),r}addMaps(t){return this.eventCount==0?this:new e(this.items.append(t.map(n=>new H(n))),this.eventCount)}rebased(t,n){if(!this.eventCount)return this;let r=[],i=Math.max(0,this.items.length-n),s=t.mapping,o=t.steps.length,l=this.eventCount;this.items.forEach(f=>{f.selection&&l--},i);let a=n;this.items.forEach(f=>{let h=s.getMirror(--a);if(h==null)return;o=Math.min(o,h);let m=s.maps[h];if(f.step){let I=t.steps[h].invert(t.docs[h]),S=f.selection&&f.selection.map(s.slice(a+1,h));S&&l++,r.push(new H(m,I,S))}else r.push(new H(m))},i);let d=[];for(let f=n;f<o;f++)d.push(new H(s.maps[f]));let c=this.items.slice(0,i).append(d).append(r),u=new e(c,l);return u.emptyItemCount()>Cr&&(u=u.compress(this.items.length-r.length)),u}emptyItemCount(){let t=0;return this.items.forEach(n=>{n.step||t++}),t}compress(t=this.items.length){let n=this.remapping(0,t),r=n.maps.length,i=[],s=0;return this.items.forEach((o,l)=>{if(l>=t)i.push(o),o.selection&&s++;else if(o.step){let a=o.step.map(n.slice(r)),d=a&&a.getMap();if(r--,d&&n.appendMap(d,r),a){let c=o.selection&&o.selection.map(n.slice(r));c&&s++;let u=new H(d.invert(),a,c),f,h=i.length-1;(f=i.length&&i[h].merge(u))?i[h]=f:i.push(u)}}else o.map&&r--},this.items.length,0),new e(je.from(i.reverse()),s)}};Z.empty=new Z(je.empty,0);function kr(e,t){let n;return e.forEach((r,i)=>{if(r.selection&&t--==0)return n=i,!1}),e.slice(n)}var H=class e{constructor(t,n,r,i){this.map=t,this.step=n,this.selection=r,this.mirrorOffset=i}merge(t){if(this.step&&t.step&&!t.selection){let n=t.step.merge(this.step);if(n)return new e(n.getMap().invert(),n,this.selection)}}},z=class{constructor(t,n,r,i,s){this.done=t,this.undone=n,this.prevRanges=r,this.prevTime=i,this.prevComposition=s}},Sr=20;function xr(e,t,n,r){let i=n.getMeta(w),s;if(i)return i.historyState;n.getMeta(Or)&&(e=new z(e.done,e.undone,null,0,-1));let o=n.getMeta("appendedTransaction");if(n.steps.length==0)return e;if(o&&o.getMeta(w))return o.getMeta(w).redo?new z(e.done.addTransform(n,void 0,r,Se(t)),e.undone,on(n.mapping.maps[n.steps.length-1]),e.prevTime,e.prevComposition):new z(e.done,e.undone.addTransform(n,void 0,r,Se(t)),null,e.prevTime,e.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let l=n.getMeta("composition"),a=e.prevTime==0||!o&&e.prevComposition!=l&&(e.prevTime<(n.time||0)-r.newGroupDelay||!Dr(n,e.prevRanges)),d=o?Ge(e.prevRanges,n.mapping):on(n.mapping.maps[n.steps.length-1]);return new z(e.done.addTransform(n,a?t.selection.getBookmark():void 0,r,Se(t)),Z.empty,d,n.time,l??e.prevComposition)}else return(s=n.getMeta("rebased"))?new z(e.done.rebased(n,s),e.undone.rebased(n,s),Ge(e.prevRanges,n.mapping),e.prevTime,e.prevComposition):new z(e.done.addMaps(n.mapping.maps),e.undone.addMaps(n.mapping.maps),Ge(e.prevRanges,n.mapping),e.prevTime,e.prevComposition)}function Dr(e,t){if(!t)return!1;if(!e.docChanged)return!0;let n=!1;return e.mapping.maps[0].forEach((r,i)=>{for(let s=0;s<t.length;s+=2)r<=t[s+1]&&i>=t[s]&&(n=!0)}),n}function on(e){let t=[];return e.forEach((n,r,i,s)=>t.push(i,s)),t}function Ge(e,t){if(!e)return null;let n=[];for(let r=0;r<e.length;r+=2){let i=t.map(e[r],1),s=t.map(e[r+1],-1);i<=s&&n.push(i,s)}return n}function an(e,t,n,r){let i=Se(t),s=w.get(t).spec.config,o=(r?e.undone:e.done).popEvent(t,i);if(!o)return;let l=o.selection.resolve(o.transform.doc),a=(r?e.done:e.undone).addTransform(o.transform,t.selection.getBookmark(),s,i),d=new z(r?a:o.remaining,r?o.remaining:a,null,0,-1);n(o.transform.setSelection(l).setMeta(w,{redo:r,historyState:d}).scrollIntoView())}var Ue=!1,ln=null;function Se(e){let t=e.plugins;if(ln!=t){Ue=!1,ln=t;for(let n=0;n<t.length;n++)if(t[n].spec.historyPreserveItems){Ue=!0;break}}return Ue}var w=new re("history"),Or=new re("closeHistory");function dn(e={}){return e={depth:e.depth||100,newGroupDelay:e.newGroupDelay||500},new F({key:w,state:{init(){return new z(Z.empty,Z.empty,null,0,-1)},apply(t,n,r){return xr(n,r,t,e)}},config:e,props:{handleDOMEvents:{beforeinput(t,n){let r=n.inputType,i=r=="historyUndo"?Ye:r=="historyRedo"?Xe:null;return i?(n.preventDefault(),i(t.state,t.dispatch)):!1}}}})}var Ye=(e,t)=>{let n=w.getState(e);return!n||n.done.eventCount==0?!1:(t&&an(n,e,t,!1),!0)},Xe=(e,t)=>{let n=w.getState(e);return!n||n.undone.eventCount==0?!1:(t&&an(n,e,t,!0),!0)};var cn=K.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:e,dispatch:t})=>Ye(e,t),redo:()=>({state:e,dispatch:t})=>Xe(e,t)}},addProseMirrorPlugins(){return[dn(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-\u044F":()=>this.editor.commands.undo(),"Shift-Mod-\u044F":()=>this.editor.commands.redo()}}});var un=y.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:e}){return["hr",p(this.options.HTMLAttributes,e)]},addCommands(){return{setHorizontalRule:()=>({chain:e})=>e().insertContent({type:this.name}).command(({tr:t,dispatch:n})=>{var r;if(n){let{$to:i}=t.selection,s=i.end();if(i.nodeAfter)t.setSelection(b.create(t.doc,i.pos));else{let o=(r=i.parent.type.contentMatch.defaultType)===null||r===void 0?void 0:r.create();o&&(t.insert(s,o),t.setSelection(b.create(t.doc,s)))}t.scrollIntoView()}return!0}).run()}},addInputRules(){return[ot({find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type})]}});var Tr=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))$/,Nr=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))/g,Ar=/(?:^|\s)((?:_)((?:[^_]+))(?:_))$/,Pr=/(?:^|\s)((?:_)((?:[^_]+))(?:_))/g,fn=T.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:e=>e.style.fontStyle!=="normal"&&null},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:e}){return["em",p(this.options.HTMLAttributes,e),0]},addCommands(){return{setItalic:()=>({commands:e})=>e.setMark(this.name),toggleItalic:()=>({commands:e})=>e.toggleMark(this.name),unsetItalic:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[L({find:Tr,type:this.type}),L({find:Ar,type:this.type})]},addPasteRules(){return[B({find:Nr,type:this.type}),B({find:Pr,type:this.type})]}});var hn=y.create({name:"listItem",addOptions(){return{HTMLAttributes:{}}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:e}){return["li",p(this.options.HTMLAttributes,e),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}});var Er=y.create({name:"listItem",addOptions(){return{HTMLAttributes:{}}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:e}){return["li",p(this.options.HTMLAttributes,e),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),pn=T.create({name:"textStyle",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"span",getAttrs:e=>e.hasAttribute("style")?{}:!1}]},renderHTML({HTMLAttributes:e}){return["span",p(this.options.HTMLAttributes,e),0]},addCommands(){return{removeEmptyTextStyle:()=>({state:e,commands:t})=>{let n=fe(e,this.type);return Object.entries(n).some(([,i])=>!!i)?!0:t.unsetMark(this.name)}}}}),mn=/^(\d+)\.\s$/,gn=y.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:e=>e.hasAttribute("start")?parseInt(e.getAttribute("start")||"",10):1}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:e}){let r=e,{start:t}=r,n=Qe(r,["start"]);return t===1?["ol",p(this.options.HTMLAttributes,n),0]:["ol",p(this.options.HTMLAttributes,e),0]},addCommands(){return{toggleOrderedList:()=>({commands:e,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(Er.name,this.editor.getAttributes(pn.name)).run():e.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let e=$({find:mn,type:this.type,getAttributes:t=>({start:+t[1]}),joinPredicate:(t,n)=>n.childCount+n.attrs.start===+t[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(e=$({find:mn,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:t=>ce({start:+t[1]},this.editor.getAttributes(pn.name)),joinPredicate:(t,n)=>n.childCount+n.attrs.start===+t[1],editor:this.editor})),[e]}});var yn=y.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:e}){return["p",p(this.options.HTMLAttributes,e),0]},addCommands(){return{setParagraph:()=>({commands:e})=>e.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}});var Ir=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))$/,Rr=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))/g,bn=T.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:e=>e.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:e}){return["s",p(this.options.HTMLAttributes,e),0]},addCommands(){return{setStrike:()=>({commands:e})=>e.setMark(this.name),toggleStrike:()=>({commands:e})=>e.toggleMark(this.name),unsetStrike:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-x":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[L({find:Ir,type:this.type})]},addPasteRules(){return[B({find:Rr,type:this.type})]}});var Mn=y.create({name:"text",group:"inline"});var hs=K.create({name:"starterKit",addExtensions(){let e=[],t=this.options;return t?.blockquote!==!1&&e.push(lt.configure(t?.blockquote)),t?.bold!==!1&&e.push(at.configure(t?.bold)),t?.bulletList!==!1&&e.push(ut.configure(t?.bulletList)),t?.code!==!1&&e.push(ft.configure(t?.code)),t?.codeBlock!==!1&&e.push(ht.configure(t?.codeBlock)),t?.document!==!1&&e.push(pt.configure(t?.document)),t?.dropcursor!==!1&&e.push(gt.configure(t?.dropcursor)),t?.gapcursor!==!1&&e.push(tn.configure(t?.gapcursor)),t?.hardBreak!==!1&&e.push(nn.configure(t?.hardBreak)),t?.heading!==!1&&e.push(rn.configure(t?.heading)),t?.history!==!1&&e.push(cn.configure(Object.assign({depth:10,newGroupDelay:100},t?.history))),t?.horizontalRule!==!1&&e.push(un.configure(t?.horizontalRule)),t?.italic!==!1&&e.push(fn.configure(t?.italic)),t?.listItem!==!1&&e.push(hn.configure(t?.listItem)),t?.orderedList!==!1&&e.push(gn.configure(t?.orderedList)),t?.paragraph!==!1&&e.push(yn.configure(t?.paragraph)),t?.strike!==!1&&e.push(bn.configure(t?.strike)),t?.text!==!1&&e.push(Mn.configure(t?.text)),e}});export{hs as StarterKit};
